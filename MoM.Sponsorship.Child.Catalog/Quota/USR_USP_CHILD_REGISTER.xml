<SQLStoredProcedureSpec
	xmlns="bb_appfx_sqlstoredprocedure"
	xmlns:common="bb_appfx_commontypes" 
	ID="e45d5851-4a2c-4931-825c-473147b76e6b"
	Name="USR_USP_CHILD_REGISTER"
	Description="REPLACE_WITH_DESCRIPTION"
	Author="Cary Mayeda"
	SPName="USR_USP_CHILD_REGISTER">
	<!-- 
	Remarks:    This will set the child passed in @childiD to registered (REGISTRATIONDATE = today's date, and FUNDED = 1)
				After the child is registered, the child will be set to either Eligible or Pending depending on if there are any pending reasons on the child.

	History:
	Date            Modified By     Comments
	02-Jul-2012		CMayeda			Initial Version

	-->

	<CreateProcedureSQL>
		<![CDATA[
create procedure dbo.USR_USP_CHILD_REGISTER (
	@childID uniqueidentifier,					-- Specify a Sponsorship Opportunity ID (same as the child's ID) if the sproc should only process a single child
	@changeAgentID uniqueidentifier)			-- Used to specify change agent for CHANGEDBYID and ADDEDBYID fields
	
as
begin
	-- Get ChangeAgent if none was passed into the sproc
  	if @changeAgentID is null  
	    exec dbo.USP_CHANGEAGENT_GETORCREATECHANGEAGENT @changeAgentID output

    -- Used for setting date fields to today's date
	declare @currentDate datetime = null  
	set @currentDate = getdate()	

	begin try
		if @childID is null 
			RAISERROR 1000000 '@childID cannot be null'		

		update dbo.USR_CHILDEXTENSION
			set REGISTRATIONDATE = @currentDate,
				FUNDED = 1,
				CHANGEDBYID = @changeAgentID,
				DATECHANGED = @currentDate
	 		-- Either get the child passed in @childID or the children in the table passed in @childIDList
		 where USR_CHILDEXTENSION.SPONSORSHIPOPPORTUNITYCHILDID = @childID
				

	 --** FIX THIS	exec dbo.USR_USP_CHILD_SETELIGIBLEORPENDING  @childIDList, @changeAgentID
		
	end try
	begin catch
		exec dbo.USP_RAISE_ERROR
		return 1	
	end catch
	
	return 0
	
end
		]]>
	</CreateProcedureSQL>

</SQLStoredProcedureSpec>
