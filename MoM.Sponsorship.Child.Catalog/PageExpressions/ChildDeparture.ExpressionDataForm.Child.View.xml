<ViewDataFormTemplateSpec
	xmlns="bb_appfx_viewdataformtemplate"
	xmlns:common="bb_appfx_commontypes"
	ID="1f930d28-2eba-40a4-948a-f724585c51ca"
	Name="Child Departure PageExpression for Child"
	Description="Page Expression DataForm for ChildDeparture information on a child"
	Author="Cary Mayeda"
	DataFormInstanceID="9776045c-445e-4abc-9dac-23c666fe4b6a"
	RecordType="Sponsorship Opportunity"
     common:SecurityUIFolder="Sponsorship\Opportunity\Child\Child Departure"
  >

	<!-- 
	Remarks:    This is used to create a new Departure for a Child.

	History:
	Date            Modified By     Comments
	04-Sep-2012		CMayeda			Copied from Child Departure PageExpression
	-->


	<!-- define the SP that returns the data used by the form -->
	<SPDataForm SPName="USR_USP_DATAFORMTEMPLATE_VIEW_CHILDDEPARTUREEXPRESSIONFORCHILD">
		<common:CreateProcedureSQL>
			<![CDATA[
create procedure dbo.USR_USP_DATAFORMTEMPLATE_VIEW_CHILDDEPARTUREEXPRESSIONFORCHILD
(
  @ID uniqueidentifier,                        -- Unique ID of the row, PK
  @DATALOADED bit = 0 output,                  -- Used by framework to determine if data found or not
  @ISPROGRAMCOMPLETION bit = null output,      -- flag: is a programcompletion or not
  @ISDEPARTURE bit = null output,              -- flag: is a departure or not
  @DEPARTUREEXISTS bit = null output,          -- used to determine if a record exists or not
  @DEPARTURETYPE nvarchar(14) = null output   -- holds the departuretypecode translated (text) value for user to see, instead of the int value
)
as
  set nocount on;
  
  -- be sure to set this, in case the select returns no rows
  set @DATALOADED = 1;         -- force this to 1 or CRM won't display the child page!
  set @DEPARTUREEXISTS = 0;

  -- populate the output parameters, which correspond to fields on the form.  Note that
  -- we set @DATALOADED = 1 to indicate that the load was successful.  Otherwise, the system
  -- will display a "no data loaded" message.

  -- Get the data from the USR_CHILDDEPARTURE table:
  select 
	   @DEPARTUREEXISTS = 1,
	   @ISPROGRAMCOMPLETION = ISPROGRAMCOMPLETION,
	   @ISDEPARTURE = ISDEPARTURE,
	   @DEPARTURETYPE = DEPARTURETYPE
  from dbo.USR_CHILDDEPARTURE
  where SPONSORSHIPOPPORTUNITYCHILDID = @ID
  and ISCURRENTDEPARTURECODE = 1;
  
  
  return 0;
	  ]]>
		</common:CreateProcedureSQL>
	</SPDataForm>

	<!-- describe fields on the form, which correspond to parameters on the SP.  Note that system paramters 
  like the context @ID, @DATALOADED, and @CURRENTAPPUSERID need not be listed. -->
	<common:FormMetaData FixedDialog="true">		
		<common:FormFields>
			<common:FormField FieldID="ISDEPARTURE" Caption="Child Departed" DataType="Boolean" />
			<common:FormField FieldID="ISPROGRAMCOMPLETION" Caption="Program Completed" DataType="Boolean" />
			<common:FormField FieldID="DEPARTUREEXISTS" Caption="Child is currently departed" DataType="Boolean" />
			<common:FormField FieldID="DEPARTURETYPE" Caption="Departure Type" DataType="String" />
		</common:FormFields>
	</common:FormMetaData>

</ViewDataFormTemplateSpec>