<SQLStoredProcedureSpec
	xmlns="bb_appfx_sqlstoredprocedure"
	xmlns:common="bb_appfx_commontypes" 
	ID="d3a4203f-35e3-43a9-8d11-0f8a7f694bf7"
	Name="USR_USP_CHILD_SETELIGIBLEORPENDING"
	Description="Set a child to pending or eligible based on if there are any pending reasons"
	Author="Cary Mayeda"
	SPName="USR_USP_CHILD_SETELIGIBLEORPENDING" >

	<!-- 
	Remarks:    Sets the child's eligibility to either Eligible or Pending based on if the child has pending reasons for the child passed in @childID
				This calls USR_USP_CHILDREN_SETELIGIBLEORPENDING to actually do the processing by passing in a table which contains the one childid passed in @childID
				This enables the code to be maintained in one sproc

	History:
	Date            Modified By     Comments
	19-Jun-2012		CMayeda			Initial Version
    09-Jul-2012		CMayeda			Modified this to call USR_USP_CHILDREN_SETELIGIBLEORPENDING
	-->
	
	<common:DependencyList>
		<common:Dependency CatalogAssembly=""  CatalogItem="USR_UDT_CHILDIDLIST"/>
		<common:Dependency CatalogAssembly="MoM.Sponsorship.Child.Catalog.dll" CatalogItem="MoM.Sponsorship.Child.Catalog.USR_USP_CHILDREN_SETELIGIBLEORPENDING"/>
		<common:Dependency CatalogAssembly="" CatalogItem="USP_CHANGEAGENT_GETORCREATECHANGEAGENT"/>
		<common:Dependency CatalogAssembly="" CatalogItem="USP_RAISE_ERROR" />
	</common:DependencyList>
	
	<CreateProcedureSQL>
		<![CDATA[

create procedure dbo.USR_USP_CHILD_SETELIGIBLEORPENDING (
	@childID uniqueidentifier,				-- Specify a Sponsorship Opportunity ID (same as the child's ID) if the sproc should only process a single child
	@doNotUpdateIneligible bit = 0,			-- Whether to include Ineligible children in updates.  0 = Include Ineligible children, 1 = Do Not Include Ineligible children
	@changeAgentID uniqueidentifier)		-- Used to specify change agent for CHANGEDBYID fields

as
begin
	-- Get ChangeAgent if none was passed into the sproc
  	if @CHANGEAGENTID is null  
	    exec dbo.USP_CHANGEAGENT_GETORCREATECHANGEAGENT @CHANGEAGENTID output

	declare @childList USR_UDT_CHILDIDLIST
	
	begin try	
		if @childID is null 
			RAISERROR 1000000 '@childID cannot be null'		

		insert @childList
		select @childID 
		
		exec dbo.USR_USP_CHILDREN_SETELIGIBLEORPENDING @childList, @doNotUpdateIneligible, @changeAgentID
		
	end try
	begin catch
		exec dbo.USP_RAISE_ERROR
		return 1	
	end catch
	
	return 0

end
		]]>
	</CreateProcedureSQL>

</SQLStoredProcedureSpec>
